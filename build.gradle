buildscript {
    repositories {
        jcenter()
        maven {url "http://files.minecraftforge.net/maven"}
        maven {url "https://plugins.gradle.org/m2/"}
    }
    dependencies {
        classpath "net.minecraftforge.gradle:ForgeGradle:2.3-SNAPSHOT"
        classpath "gradle.plugin.com.matthewprenger:CurseGradle:1.0.9"
		classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:1.2.30"
    }
}
apply plugin: "kotlin"
apply plugin: "net.minecraftforge.gradle.forge"
apply plugin: "com.matthewprenger.cursegradle"

String ttag = System.getenv("TRAVIS_TAG")
version = ttag ? ttag : "0.0.0-x"
group = "szewek.fl"
archivesBaseName = "fl"

sourceCompatibility = targetCompatibility = "1.8"
compileJava {
    sourceCompatibility = targetCompatibility = "1.8"
}
compileKotlin {
    sourceCompatibility = targetCompatibility = "1.8"
}

task sourcesJar(type: Jar, dependsOn: "sourceJar") {
    from (sourceSets.main.allSource) {
		include "szewek/fl/R.kt"
		expand 'version': project.version
	}
	from (sourceSets.main.allSource) {
		exclude "szewek/fl/R.kt"
	}
    from sourceSets.api.allSource
	from sourceSets.main.allSource
	classifier = "sources"
}

repositories {
    jcenter()
    maven {url "http://maven.shadowfacts.net/"}
}
dependencies {
    compile group: "net.shadowfacts", name: "Forgelin", version: "1.6.0"
}

minecraft {
    version = "1.12.2-14.23.1.2562"
    runDir = "run"
    mappings = "snapshot_20180301"
    replace '\${version}', project.version
    replaceIn "R.java"
}

processResources {
    inputs.property "version", project.version
    inputs.property "mcversion", project.minecraft.version

    from(sourceSets.main.resources.srcDirs) {
        include 'mcmod.info'
        expand 'version':project.version, 'mcversion':project.minecraft.version
    }

    from(sourceSets.main.resources.srcDirs) {
        exclude 'mcmod.info'
    }
}
curseforge {
    String cfkey = System.getenv("CURSEFORGE_KEY")
    apiKey = cfkey ? cfkey : ""
    project {
        id = "262385"
        releaseType = "beta"
        changelogType = "markdown"
        changelog = file("LATEST.md")
        addArtifact sourcesJar
    }
}

artifacts {
    archives sourcesJar
}